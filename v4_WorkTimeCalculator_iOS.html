<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Work Time Calculator</title>
	<style>
		body {
			font-family: 'Courier New', Courier, monospace;
			background: #4E525A;	/* #77858C */
			margin: 0;
			padding: 0;
			display: flex;
			justify-content: center;
			align-items: center;
			height: 100vh;
		}

		.schermo-iphone {
			width: 100%;
			max-width: 390px;
			height: auto;
			aspect-ratio: 390 / 844; 
			position: relative;
			padding-left: 5px;
			padding-right: 5px;
			display: flex;
			border: 3.5px solid #010101;
			border-collapse: collapse;
			box-shadow: 0px 0px 1px #010101;
			border-radius: 8.5px;
			border-spacing: 0px;
			background: #010101;
			overflow: hidden visible;
			cursor: default;
		}
		
		.fmc-screen {
			height: 80%;
			margin: 100px auto;
			margin-top: 10%;
			display: block;
			justify-content: space-between; 
			align-items: center;  
			padding: 3%;
			border: 0px solid #666;
			border-collapse: collapse;
			border-radius: 8.5px;
			border-spacing: 0px;
			background: #010101;
			overflow: hidden;
			user-select: none;	/* Impedisce la selezione del testo sullo schermo */
			-webkit-user-select: none;	/* Impedisce la selezione del testo sullo schermo su Safari*/
			cursor: default;
			table-layout: auto;
			box-sizing: border-box;
		}

		table.fmc-screen td {
			font-size: 14.3px;
			font-weight: 100;
			line-height: 13px;
			letter-spacing: 1.5px;
			background: #010101;
			color: #00FF00;
			border: 0px solid #00FF00;
			padding-top: 0.8rem;
			padding-bottom: 0.8rem;
		}

		table.fmc-screen tr:last-child td:first-child,
		table.fmc-screen tr:last-child td:last-child {
			border-bottom-left-radius: 0;
		}

		table.fmc-screen td:nth-child(1) {
			text-align: right;
			padding-left: 0;
			padding-right: 0.8rem;
		}

		table.fmc-screen td:nth-child(2) {
			width: 50%;
			text-align: left;
			padding-left: 0;
			padding-right: 0;
		}

		table.fmc-screen td:nth-child(3) {
			text-align: right;
			padding-left: 0;
			padding-right: 0;
		}

		table.fmc-screen td:nth-child(4) {
			text-align: left;
			padding-left: 0.8rem;
			padding-right: 0;
			margin: 0;
		}

		/* Personalizza il colore della selezione negli input box */
		input[type=time]::-webkit-datetime-edit-hour-field:focus,
		input[type=time]::-webkit-datetime-edit-minute-field:focus,
		input[type=time]::-webkit-datetime-edit-second-field:focus,
		input[type=time]::-webkit-datetime-edit-ampm-field:focus {
			background-color: #009900;
		}

		/* Personalizza il checkbox */
		input[type="checkbox"] {
			display: none;	/* Nascondi il checkbox di default */
			width: 24px;
			height: 24px;
		}

		input[type="checkbox"]+label {
			position: relative;
			display: inline-block;
			width: 35px;
			height: 17px;
			color: #00FF00;
			text-align: center;
			line-height: 16px;
			border: 0px solid #00FF00;
			background-color: #010101;
			border-radius: 3px;
			margin-right: -2px;
			cursor: pointer;
			pointer-events: none;	/* DIsabilita l'interazione diretta con il checkbox (per usare il bottone al lato) */
		}

		/* Parentesi quadre senza monospace nel checkbox*/
		input[type="checkbox"]+label::before {
			content: "[ ]";
			position: relative;
			top: 0px;
			left: 1px;
			font-size: 19.3px;
			letter-spacing: 0px;
			color: #00FF00;
		}

		/* Aggiungi la "X" quando viene selezionato il checkbox */
		input[type="checkbox"]:checked+label::after {
			content: "x";
			position: absolute;
			top: 0px;
			left: 12.7px;
			font-size: 19.3px;
			color: #00FF00;
		}

		/* Personalizza gli input Time e DateTime*/
		input[type="time"],
		input[type="text"] {
			background: #010101;
			color: #00FF00;
			border: 0px solid #00FF00;
			border-radius: 0px;
			font-size: 22.1px;
			font-family: 'Courier New', Courier, monospace;
			font-weight: 100;
		}

		input[type="time"] {
			padding-left: 0px;
			padding-right: 0px;
			padding-top: 0px;
			padding-bottom: 0px;
			margin-top: 0px;
			margin-bottom: 0px;
			margin-left: -2.7px;
			margin-right: -1px;
			width: 116px;
			height: 20px;
		}

		.textdatetime {	/* DateTime */
			margin-top: 1px;
			margin-bottom: -2px;
			margin-left: 0px;
			margin-right: -1px;
			letter-spacing: 0.7px;
			width: 4.4rem;
			height: 18px;
		}
		
		.textinputs {	/* Work Time, Clock In, Break Min, Break Start, Break End inputs */
			padding-left: 2px;
			padding-right: 0px;
			padding-top: 0px;
			padding-bottom: 0px;
			margin-top: 0px;
			margin-bottom: 0px;
			margin-left: -2.7px;
			margin-right: -2.7px;
			width: 116px;
			height: 20px;
			letter-spacing: 1px;
		}
		
		.textinputs::placeholder {
		  color: #00FF00;
		}

		
		.datetime-container {
		    display: flex;
		    margin-right: -2px;
		    margin-left: -0.55rem;
		    padding: 0;
		    gap: 0.5rem;  /* Imposta la distanza tra gli input data e ora */
		}

		#date, #timenow {
			pointer-events: none;	/* Nascondi la possibilità di cliccare sul campo data e ora*/
			background-color: #010101;
			color: #00FF00;
		}
		
		#date {
			letter-spacing: 0.4px;
			text-align: right;
		}

		/* Personalizza bottoni schermo*/
		.clr-btn,
		.stp-btn,
		.getlogs-btn,
		.clearlogs-btn,
		.save-btn {
			background-color: #010101;
			color: #00FF00;
			width: 35px;
			height: 17px;	/* Assicurati che sia uguale al checkbox */
			line-height: 16px;
			border: 0px solid #00FF00;
			padding: 0px;
			cursor: pointer;
			font-size: 19.3px;	/* Assicurati che sia uguale al checkbox */
			font-family: 'Courier New', monospace;
			font-weight: 100;
			border-radius: 3px;
			text-align: center;
			position: relative;
			top: 0;
		}
		
		.save-btn {
			left: 0.05rem;
		}

		.clr-btn,
		.stp-btn {
			left: -5px;
			pointer-events: none;	/* Disabilita l'interazione diretta con il bottone (per usare il bottone al lato) */
		}

		.getlogs-btn {
			margin-right: -2px;
			pointer-events: none;
		}

		.clearlogs-btn {
			right: -2px;
		}

		/* Cambia la dimensione del contenuto per farlo corrispondere meglio */
		.clr-btn::before,
		.stp-btn::before,
		.getlogs-btn::before,
		.clearlogs-btn::before,
		.save-btn::before {
			content: "[ ]";
			font-size: 19.3px;
			position: relative;
			letter-spacing: 0px;
			font-weight: 100;
			top: 0;
			left: 1px;
		}

		.clr-btn.active::before,
		.stp-btn.active::before,
		.getlogs-btn.active::before,
		.clearlogs-btn.active::before,
		.save-btn.active::before {
			content: "[x]";	/* Quando il bottone è attivo, mostra la X tra parentesi */
		}

		.containerinputs {
		    position: relative;
		}
		
		.worktime-btn-popup,
		.clockin-btn-popup,
		.breakstart-btn-popup,
		.breakend-btn-popup,
		.breakmin-btn-popup {
			background-color: #010101;
			color: #00FF00;
			opacity: 0;
			height: 17px;	/* Assicurati che sia uguale al checkbox */
			line-height: 16px;
			border: 0px solid #00FF00;
			padding: 0px;
			cursor: pointer;
			font-size: 19.3px;	/* Assicurati che sia uguale al checkbox */
			font-family: 'Courier New', monospace;
			font-weight: 100;
			border-radius: 3px;
			text-align: center;
			position: absolute;
			top: 0;
		}
		
		.worktime-btn-popup,
		.clockin-btn-popup,
		.breakstart-btn-popup,
		.breakend-btn-popup {
			width: 110px;
		}
		
		.breakmin-btn-popup {
			width: 70px;
		}

		/* Personalizza span Save Button */
		.save-span {
			margin-top: 0.42rem;
			margin-bottom: 0;
			margin-right: 0;
			margin-left: 8.4rem;
			font-size: 14.3px;
			font-weight: 100;
			color: #00FF00;
			line-height: 13.7px;
			letter-spacing: 1px;
			padding: 0;
			display: block;
			position: absolute;
			z-index: 3 !important;
		}

		/* Rimuovi l'icona dell'orologio nei campi di input di tipo time */
		input[type="time"]::-webkit-calendar-picker-indicator,
		input[type="date"]::-webkit-calendar-picker-indicator {
			display: none;
			-webkit-appearance: none;
		}

		input:focus, button:focus {		/* Rimuovi bordi e illuminazione di input e bottoni su Chrome */
			outline: none;
			box-shadow: none;
		}

		/* Rimuovi contorni dal riquadro di testo editabile Clock Out quando Time Left è finito */
		#editabletimehours:focus,
		#editabletimeminutes:focus,
		#editabletimeseconds:focus {
		  outline: none;
		  border: none; 
		  box-shadow: none;
		}
		
		.pausa-pranzo-input {
			display: none;
		}

		.start-reg-input {
			display: none;
		}

		input[type="time"]::-webkit-datetime-edit-fields-wrapper,
		input[type="date"]::-webkit-datetime-edit-fields-wrapper {
			display: flex;
		}

		/* Spazio tra i campi time - tra ore e minuti, minuti e secondi */
		input[type="time"]::-webkit-datetime-edit-text {
			border: 0px solid #00FF00;
			margin-right: 2px;
			margin-left: 1.55px;
			letter-spacing: -1.75px;
		}

		input[type="date"]::-webkit-datetime-edit-text {
			border: 0px solid #00FF00;
			margin-right: 0px;
			margin-left: 0px;
			letter-spacing: 0px;
		}

		/* Personalizza animazione Time Left */
		.blink {
			animation: blink-animation 1.5s linear infinite;
		}

		@keyframes blink-animation {
			0% {opacity: 1;}		/* Visibile all'inizio */
			70% {opacity: 1;}		/* Ancora visibile fino al 70% */
			71% {opacity: 0;}		/* Invisibile al 71% */
			99% {opacity: 0;}		/* Ancora invisibile fino al 99% */
			100% {opacity: 1;}	/* Ritorna visibile alla fine */
		}

		/* Personalizza Clock Out e Time Left */
		.clockout-output,
		.timeleft-output {
			margin-top: -0.1rem;
			margin-bottom: 0;
			padding: 0;
			border: 0px solid #00FF00;
			font-size: 22.1px;
			font-weight: 100;
			line-height: 21px;
			display: block;
		}

		.clockout-output {
			margin-right: 0;
		}

		.timeleft-output {
			margin-right: -3px;
		}

		.external-btns {
			font-size: 0;
			width: 15px;
			height: 15px;
			background-color: #009900;
			border-left: 0.2px solid transparent;
			border-right: 0.2px solid transparent;
			border-bottom: 0.2px solid #40d940;
			border-top: 0.8px solid #4de64d;
			border-radius: 40%;
			cursor: pointer;
			transition: transform 0.15s ease, background-color 0.15s ease;	/* Anima il colore di sfondo */
			z-index: 3 !important;
		}

		.external-btns.active {
			transform: scale(1.1);	/* Ingrandimento quando viene attivato il bottone */
			background-color: #40d940;	/* Colore più chiaro quando viene attivato il bottone */
		}

		.worktime-btn,
		.breakstart-btn,
		.enterclockin-btn,
		.breakend-btn {
			margin-top: 1.25rem;
		}
		
		.breakmin-btn {
			margin-top: 1.4rem;
		}

		.breakdone-btn {
			margin-top: 1.2rem;
		}

		.stp-btn-external,
		.getlogs-btn-external {
			margin-top: 1.35rem;
		}
		
		.clr-btn-external {
			margin-top: 1.3rem;
		}

		.timeleft-btn {
			margin-top: 1.45rem;
		}
		
		.clockout-btn {
			margin-top: 1.45rem;
		}

		.datetime-btn {
			margin-top: 1.35rem;
		}
		
		/* Popup nascosto di default */
		.popup {
		    position: fixed;
		    top: 50%;
		    left: 50%;
		    transform: translate(-50%, -50%);
		    background-color: #010101;
		    color: #00FF00;
			border: 2px solid #00FF00;
		    padding: 20px;
		    border-radius: 5px;
		    display: none; /* Inizialmente nascosto */
		}
		
		/* Contenitore con allineamento orizzontale */
		.time-container {
		    display: flex;
		    justify-content: center;
		}
		
		/* Stile degli input */
		.time-box {
		    width: 50px;
		    padding: 5px;
		    font-family: 'Courier New', Courier, monospace;
		    font-size: 22.1px;
		    text-align: center;
		    border: 1px solid #00FF00;
		    border-radius: 5px;
		    background-color: #010101;
		    color: #00FF00;
		}
		
		#hours-worktime::placeholder,
		#minutes-worktime::placeholder,
		#seconds-worktime::placeholder,
		#hours-clockin::placeholder,
		#minutes-clockin::placeholder,
		#seconds-clockin::placeholder,
		#hours-breakstart::placeholder,
		#minutes-breakstart::placeholder,
		#seconds-breakstart::placeholder,
		#hours-breakend::placeholder,
		#minutes-breakend::placeholder,
		#seconds-breakend::placeholder,
		#hours-breakmin::placeholder,
		#minutes-breakmin::placeholder {
		    color: #00FF00;
		}

	</style>
</head>



<body>
	<div class="schermo-iphone">
		<table class="fmc-screen">
			<tbody>
				<tr>
					<td></td>
					<td colspan="2" style="text-align: center; vertical-align: middle; font-size: 20px;">
						<p style='margin-bottom: 5%;'>WORK TIME CALCULATOR</p>
					</td>
					<td></td>
				</tr>
				<tr>
					<td>
						<button class="external-btns worktime-btn" id="worktime-btn"></button>
					</td>
					<td>
						<span style="display: block; margin-bottom: 0.3rem;">WORK TIME</span>
						<div class="containerinputs">
							<button class="worktime-btn-popup" id="worktime-btn-popup"></button>
							<input type="text" class="textinputs" id="work-time" placeholder="--:--:--" readonly>
						</div>
					</td>
					<td>
						<span style="display: block; margin-bottom: 0.3rem;">CLOCK IN</span>
						<div class="containerinputs">
							<button class="clockin-btn-popup" id="clockin-btn-popup"></button>
							<input type="text" class="textinputs" id="clock-in" placeholder="--:--:--" readonly>
						</div>
					</td>
					<td>
						<button class="external-btns enterclockin-btn" id="enterclockin-btn"></button>
					</td>
				</tr>
				<tr>
					<td>
						<button class="external-btns breakmin-btn" id="breakmin-btn"></button>
					</td>
					<td>
						<span style="margin-top: 1px; display: block; margin-bottom: 0.3rem;">BREAK MIN</span>
						<div class="containerinputs">
							<button class="breakmin-btn-popup" id="breakmin-btn-popup"></button>
							<input type="text" class="textinputs" id="duratamin-pausa" placeholder="--:--" readonly>
						</div>
					</td>
					<td class="pausa-pranzo">
						<span style="margin-top: -2px; display: block; margin-bottom: 0.3rem;">BREAK DONE</span>
						<input type="checkbox" id="pausa-pranzo">
						<label for="pausa-pranzo"></label>
					</td>
					<td>
						<button class="external-btns breakdone-btn" id="breakdone-btn"></button>
					</td>
				</tr>
				<tr>
					<td>
						<button class="external-btns breakstart-btn" id="breakstart-btn"></button>
					</td>
					<td>
						<span style="margin-bottom: 1px; display: block; margin-bottom: 0.3rem;">BREAK START</span>
						<div class="containerinputs">
							<button class="breakstart-btn-popup" id="breakstart-btn-popup"></button>
							<input type="text" class="textinputs" id="inizio-pausa" placeholder="--:--:--" readonly>
						</div>
					</td>
					<td>
						<span style="margin-bottom: 1px; display: block; margin-bottom: 0.3rem;">BREAK END</span>
						<div class="containerinputs">
							<button class="breakend-btn-popup" id="breakend-btn-popup"></button>
							<input type="text" class="textinputs" id="fine-pausa" placeholder="--:--:--" readonly>
						</div>
					</td>
					<td>
						<button class="external-btns breakend-btn" id="breakend-btn"></button>
					</td>
				</tr>
				<tr>
					<td>
						<button class="external-btns clr-btn-external" id="clr-btn-external"></button>
					</td>
					<td>
						<span style="display: block; margin-bottom: 0.3rem;">CLR</span>
						<button class="clr-btn" id="clr-btn"></button>
					</td>
					<td>
						<span style="display: block; margin-bottom: 0.3rem;">DATETIME</span>
						<div class="datetime-container">
							<input type="text" class="textdatetime" id="date" name="date">
							<input type="text" class="textdatetime" id="timenow" name="timenow">
						</div>
					</td>
					<td>
						<button class="external-btns datetime-btn" id="datetime-btn"></button>
					</td>
				</tr>
				<tr>
					<td>
						<button class="external-btns stp-btn-external" id="stp-btn-external"></button>
					</td>
					<td>
						<span style="margin-top: 2px; display: block; margin-bottom: 0.3rem;">END</span>
						<button class="stp-btn" id="stp-btn"></button>
						<span class="save-span" style="display: none;">SAVE <br>
							<button class="save-btn" id="save-btn"></button>
						</span>
					</td>
					<td>
						<span style="margin-top: 2px; display: block; margin-bottom: 0.3rem;">LOGDEL/GETLOG</span>
						<button class="clearlogs-btn" id="clearlogs-btn"></button>
						<span style="font-size: 22.1px; position: relative; margin-right: -17px; margin-left: -8px; top: 2.25px;"> / </span>
						<button class="getlogs-btn" id="getlogs-btn"></button>
					</td>
					<td>
						<button class="external-btns getlogs-btn-external" id="getlogs-btn-external"></button>
					</td>
				</tr>
				<tr>
					<td>
						<button class="external-btns clockout-btn" id="clockout-btn"></button>
					</td>
					<td style="font-size: 22.1px; font-weight: 100; margin-top: -2px;">
						<output class="clockout-output" id="clock-out" contenteditable="false"><span style='font-size: 14.3px; margin-bottom: 0.3rem;'>CLOCK OUT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--</output>
					</td>
					<td style="font-size: 22.1px; font-weight: 100; margin-top: -2px;">
						<output class="timeleft-output" id="countdown"><span style='font-size: 14.3px; position: relative; left: -1.4px; margin-bottom: 0.3rem;'>TIME LEFT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--</output>
					</td>
					<td>
						<button class="external-btns timeleft-btn" id="timeleft-btn"></button>
					</td>
				</tr>
			
			</tbody>
		</table>
	</div>
	<audio id="alarm-sound" src="alarm.mp3" preload="auto"></audio>


	<div id="popup-worktime" class="popup" style="display: none;">
	    <div class="time-container">
	        <input type="tel" inputmode="numeric" id="hours-worktime" class="time-box" maxlength="2" placeholder="HH"><span style="letter-spacing: 0px; font-size: 22.1px; margin-top: 5px;">:</span>
	        <input type="tel" inputmode="numeric" id="minutes-worktime" class="time-box" maxlength="2" placeholder="MM"><span style="letter-spacing: 0px; font-size: 22.1px; margin-top: 5px;">:</span>
	        <input type="tel" inputmode="numeric" id="seconds-worktime" class="time-box" maxlength="2" placeholder="SS">
	    </div>
	</div>
				
	<div id="popup-clockin" class="popup">
		<div class="time-container">
			<input type="tel" inputmode="numeric" id="hours-clockin" class="time-box" maxlength="2" placeholder="HH"><span style="letter-spacing: 0px; font-size: 22.1px; margin-top: 5px;">:</span>
			<input type="tel" inputmode="numeric" id="minutes-clockin" class="time-box" maxlength="2" placeholder="MM"><span style="letter-spacing: 0px; font-size: 22.1px; margin-top: 5px;">:</span>
			<input type="tel" inputmode="numeric" id="seconds-clockin" class="time-box" maxlength="2" placeholder="SS">
		</div>
	</div>
	
	<div id="popup-breakstart" class="popup">
		<div class="time-container">
			<input type="tel" inputmode="numeric" id="hours-breakstart" class="time-box" maxlength="2" placeholder="HH"><span style="letter-spacing: 0px; font-size: 22.1px; margin-top: 5px;">:</span>
			<input type="tel" inputmode="numeric" id="minutes-breakstart" class="time-box" maxlength="2" placeholder="MM"><span style="letter-spacing: 0px; font-size: 22.1px; margin-top: 5px;">:</span>
			<input type="tel" inputmode="numeric" id="seconds-breakstart" class="time-box" maxlength="2" placeholder="SS">
		</div>
	</div>
	
	<div id="popup-breakend" class="popup">
		<div class="time-container">
			<input type="tel" inputmode="numeric" id="hours-breakend" class="time-box" maxlength="2" placeholder="HH"><span style="letter-spacing: 0px; font-size: 22.1px; margin-top: 5px;">:</span>
			<input type="tel" inputmode="numeric" id="minutes-breakend" class="time-box" maxlength="2" placeholder="MM"><span style="letter-spacing: 0px; font-size: 22.1px; margin-top: 5px;">:</span>
			<input type="tel" inputmode="numeric" id="seconds-breakend" class="time-box" maxlength="2" placeholder="SS">
		</div>
	</div>
	
	<div id="popup-breakmin" class="popup">
		<div class="time-container">
			<input type="tel" inputmode="numeric" id="hours-breakmin" class="time-box" maxlength="2" placeholder="HH"><span style="letter-spacing: 0px; font-size: 22.1px; margin-top: 5px;">:</span>
			<input type="tel" inputmode="numeric" id="minutes-breakmin" class="time-box" maxlength="2" placeholder="MM">
		</div>
	</div>



	<script>
		// Aggiunge la classe 'active' ai bottoni esterni quando attivati e la toglie con ritardo
		const buttons = document.querySelectorAll('.external-btns');
		buttons.forEach(button => {
			button.addEventListener('click', () => {
				button.classList.add('active');
				setTimeout(() => {
					button.classList.remove('active');
				}, 460);
			});
		});
		
		// Imposta allarme sonoro su nullo di default
		var alarmInterval = null;



		//*****************************************************LOGICA POPUP**************************************************
		// Popup Work Time
		document.getElementById('worktime-btn-popup').addEventListener('click', function() {
		    var popup = document.getElementById('popup-worktime');
		    popup.style.display = 'block';
		});
		
		// Popup Clock In
		document.getElementById('clockin-btn-popup').addEventListener('click', function() {
		    var popup = document.getElementById('popup-clockin');
		    popup.style.display = 'block';
		});
		
		// Popup Break Start
		document.getElementById('breakstart-btn-popup').addEventListener('click', function() {
		    var popup = document.getElementById('popup-breakstart');
		    popup.style.display = 'block';
		});
		
		// Popup Break End
		document.getElementById('breakend-btn-popup').addEventListener('click', function() {
		    var popup = document.getElementById('popup-breakend');
		    popup.style.display = 'block';
		});
		
		// Popup Break Min
		document.getElementById('breakmin-btn-popup').addEventListener('click', function() {
		    var popup = document.getElementById('popup-breakmin');
		    popup.style.display = 'block';
		});
		
		
		// Logica di gestione popup
		const timeInputWorktime = document.getElementById("work-time");
		const popupWorktime = document.getElementById("popup-worktime");
		const hoursWorktimeInput = document.getElementById("hours-worktime");
		const minutesWorktimeInput = document.getElementById("minutes-worktime");
		const secondsWorktimeInput = document.getElementById("seconds-worktime");
		
		const timeInputClockin = document.getElementById("clock-in");
		const popupClockin = document.getElementById("popup-clockin");
		const hoursClockinInput = document.getElementById("hours-clockin");
		const minutesClockinInput = document.getElementById("minutes-clockin");
		const secondsClockinInput = document.getElementById("seconds-clockin");
		
		const timeInputBreakstart = document.getElementById("inizio-pausa");
		const popupBreakstart = document.getElementById("popup-breakstart");
		const hoursBreakstartInput = document.getElementById("hours-breakstart");
		const minutesBreakstartInput = document.getElementById("minutes-breakstart");
		const secondsBreakstartInput = document.getElementById("seconds-breakstart");
		
		const timeInputBreakend = document.getElementById("fine-pausa");
		const popupBreakend = document.getElementById("popup-breakend");
		const hoursBreakendInput = document.getElementById("hours-breakend");
		const minutesBreakendInput = document.getElementById("minutes-breakend");
		const secondsBreakendInput = document.getElementById("seconds-breakend");
		
		const timeInputBreakmin = document.getElementById("duratamin-pausa");
		const popupBreakmin = document.getElementById("popup-breakmin");
		const hoursBreakminInput = document.getElementById("hours-breakmin");
		const minutesBreakminInput = document.getElementById("minutes-breakmin");
		
		
		// Mostra il popup e resetta i valori a vuoto per work-time
		timeInputWorktime.addEventListener("click", () => {
		    // Reset dei valori
		    hoursWorktimeInput.value = "";
		    minutesWorktimeInput.value = "";
		    secondsWorktimeInput.value = "";
		    
		    popupWorktime.style.display = "block"; // Mostra il popup
		        
			setTimeout(() => {
				popupWorktime.classList.remove("show");
			}, 5000);
		});


		// Mostra il popup e resetta i valori a vuoto per clock-in
		timeInputClockin.addEventListener("click", () => {
		    // Reset dei valori
		    hoursClockinInput.value = "";
		    minutesClockinInput.value = "";
		    secondsClockinInput.value = "";
		    
		    // Mostra il popup
		    popupClockin.style.display = "block"; // Cambia display a block
		
		    // Focus sull'input per clock-in
		    hoursClockinInput.focus();
		    
		    // Timeout per chiudere il popup dopo 5 secondi
		    setTimeout(() => {
		        popupClockin.style.display = "none"; // Nascondi il popup dopo 5 secondi
		    }, 5000);
		});


		// Mostra il popup e resetta i valori a vuoto per breakstart
		timeInputBreakstart.addEventListener("click", () => {
		    // Reset dei valori
		    hoursBreakstartInput.value = "";
		    minutesBreakstartInput.value = "";
		    secondsBreakstartInput.value = "";
		    
		    // Mostra il popup
		    popupBreakstart.style.display = "block"; // Cambia display a block
		
		    // Focus sull'input per clock-in
		    hoursBreakstartInput.focus();
		    
		    // Timeout per chiudere il popup dopo 5 secondi
		    setTimeout(() => {
		        popupBreakstart.style.display = "none"; // Nascondi il popup dopo 5 secondi
		    }, 5000);
		});


		// Mostra il popup e resetta i valori a vuoto per breakend
		timeInputBreakend.addEventListener("click", () => {
		    // Reset dei valori
		    hoursBreakendInput.value = "";
		    minutesBreakendInput.value = "";
		    secondsBreakendInput.value = "";
		    
		    // Mostra il popup
		    popupBreakend.style.display = "block"; // Cambia display a block
		
		    // Focus sull'input per clock-in
		    hoursBreakendInput.focus();
		    
		    // Timeout per chiudere il popup dopo 5 secondi
		    setTimeout(() => {
		        popupBreakend.style.display = "none"; // Nascondi il popup dopo 5 secondi
		    }, 5000);
		});


		// Mostra il popup e resetta i valori a vuoto per breakmin
		timeInputBreakmin.addEventListener("click", () => {
		    // Reset dei valori
		    hoursBreakminInput.value = "";
		    minutesBreakminInput.value = "";
		    
		    // Mostra il popup
		    popupBreakmin.style.display = "block"; // Cambia display a block
		
		    // Focus sull'input per clock-in
		    hoursBreakminInput.focus();
		    
		    // Timeout per chiudere il popup dopo 5 secondi
		    setTimeout(() => {
		        popupBreakmin.style.display = "none"; // Nascondi il popup dopo 5 secondi
		    }, 5000);
		});


		// Funzione per chiudere il popup e aggiornare l'input
		function closePopup(inputField, popup, hoursInput, minutesInput, secondsInput) {
		    // Verifica che i valori siano validi
		    validateTime(hoursInput, 0, 24);
		    validateTime(minutesInput, 0, 59);
		    validateTime(secondsInput, 0, 59);
		    
		    // Imposta il valore del campo input principale nel formato HH:MM:SS
		    inputField.value = `${hoursInput.value}:${minutesInput.value}:${secondsInput.value}`;
		    popup.style.display = "none"; // Nascondi il pop-up
		}
		
		function closePopupBreakMin(inputField, popup, hoursInput, minutesInput) {
		    // Verifica che i valori siano validi
		    validateTime(hoursInput, 0, 24);
		    validateTime(minutesInput, 0, 59);
		    
		    // Imposta il valore del campo input principale nel formato HH:MM:SS
		    inputField.value = `${hoursInput.value}:${minutesInput.value}`;
		    popup.style.display = "none"; // Nascondi il pop-up
		}


		// Funzione per correggere i valori fuori range
		function validateTime(input, min, max) {
		    let value = parseInt(input.value) || 0;
		    if (value < min) value = min;
		    if (value > max) value = max;
		    input.value = String(value).padStart(2, "0");
		}


		// Chiudi il popup quando il campo è completato
		[hoursWorktimeInput, minutesWorktimeInput, secondsWorktimeInput].forEach((input, index, inputs) => {
		    input.addEventListener("input", () => {
		        if (input.value.length === 2) {
		            if (index < inputs.length - 1) {
		                inputs[index + 1].focus();
		            } else {
		                closePopup(timeInputWorktime, popupWorktime, hoursWorktimeInput, minutesWorktimeInput, secondsWorktimeInput);
		            }
		        }
		    });
		});
		
		[hoursClockinInput, minutesClockinInput, secondsClockinInput].forEach((input, index, inputs) => {
		    input.addEventListener("input", () => {
		        if (input.value.length === 2) {
		            if (index < inputs.length - 1) {
		                inputs[index + 1].focus();
		            } else {
		                closePopup(timeInputClockin, popupClockin, hoursClockinInput, minutesClockinInput, secondsClockinInput);
		            }
		        }
		    });
		});
		
		[hoursBreakstartInput, minutesBreakstartInput, secondsBreakstartInput].forEach((input, index, inputs) => {
		    input.addEventListener("input", () => {
		        if (input.value.length === 2) {
		            if (index < inputs.length - 1) {
		                inputs[index + 1].focus();
		            } else {
		                closePopup(timeInputBreakstart, popupBreakstart, hoursBreakstartInput, minutesBreakstartInput, secondsBreakstartInput);
		            }
		        }
		    });
		});
		
		[hoursBreakendInput, minutesBreakendInput, secondsBreakendInput].forEach((input, index, inputs) => {
		    input.addEventListener("input", () => {
		        if (input.value.length === 2) {
		            if (index < inputs.length - 1) {
		                inputs[index + 1].focus();
		            } else {
		                closePopup(timeInputBreakend, popupBreakend, hoursBreakendInput, minutesBreakendInput, secondsBreakendInput);
		            }
		        }
		    });
		});
		
		[hoursBreakminInput, minutesBreakminInput].forEach((input, index, inputs) => {
		    input.addEventListener("input", () => {
		        if (input.value.length === 2) {
		            if (index < inputs.length - 1) {
		                inputs[index + 1].focus();
		            } else {
		                closePopupBreakMin(timeInputBreakmin, popupBreakmin, hoursBreakminInput, minutesBreakminInput);
		            }
		        }
		    });
		});
		
		
		// Chiude il popup se si clicca fuori dal popup
		window.addEventListener('click', function(event) {
		    var popup = document.getElementById('popup-worktime');
		    if (!popup.contains(event.target) && !document.getElementById('worktime-btn-popup').contains(event.target)) {
		        popup.style.display = 'none';
		    }
		});
		
		window.addEventListener('touchstart', function(event) {
		    var popup = document.getElementById('popup-worktime');
		    if (!popup.contains(event.target) && !document.getElementById('worktime-btn-popup').contains(event.target)) {
		        popup.style.display = 'none';
		    }
		});
		

		window.addEventListener('click', function(event) {
		    var popup = document.getElementById('popup-clockin');
		    if (!popup.contains(event.target) && !document.getElementById('clockin-btn-popup').contains(event.target)) {
		        popup.style.display = 'none';
		    }
		});
		
		window.addEventListener('touchstart', function(event) {
		    var popup = document.getElementById('popup-clockin');
		    if (!popup.contains(event.target) && !document.getElementById('clockin-btn-popup').contains(event.target)) {
		        popup.style.display = 'none';
		    }
		});


		window.addEventListener('click', function(event) {
		    var popup = document.getElementById('popup-breakstart');
		    if (!popup.contains(event.target) && !document.getElementById('breakstart-btn-popup').contains(event.target)) {
		        popup.style.display = 'none';
		    }
		});
		
		window.addEventListener('touchstart', function(event) {
		    var popup = document.getElementById('popup-breakstart');
		    if (!popup.contains(event.target) && !document.getElementById('breakstart-btn-popup').contains(event.target)) {
		        popup.style.display = 'none';
		    }
		});
		

		window.addEventListener('click', function(event) {
		    var popup = document.getElementById('popup-breakend');
		    if (!popup.contains(event.target) && !document.getElementById('breakend-btn-popup').contains(event.target)) {
		        popup.style.display = 'none';
		    }
		});
		
		window.addEventListener('touchstart', function(event) {
		    var popup = document.getElementById('popup-breakend');
		    if (!popup.contains(event.target) && !document.getElementById('breakend-btn-popup').contains(event.target)) {
		        popup.style.display = 'none';
		    }
		});
		
		
		window.addEventListener('click', function(event) {
		    var popup = document.getElementById('popup-breakmin');
		    if (!popup.contains(event.target) && !document.getElementById('breakmin-btn-popup').contains(event.target)) {
		        popup.style.display = 'none';
		    }
		});
		
		window.addEventListener('touchstart', function(event) {
		    var popup = document.getElementById('popup-breakmin');
		    if (!popup.contains(event.target) && !document.getElementById('breakmin-btn-popup').contains(event.target)) {
		        popup.style.display = 'none';
		    }
		});



		//*****************************************************OTTIENI DATA E ORA ATTUALE*****************************************************
		function updateTime() {
			const now = new Date();
			const day = now.getDate();
			const month = now.getMonth() + 1; // I mesi partono da 0
			const hours = String(now.getHours()).padStart(2, '0');
			const minutes = String(now.getMinutes()).padStart(2, '0');
			// Formato D/M HH:MM
			const formattedTimeDate = `${day}/${month}`;
			const formattedTimeTime = `${hours}:${minutes}`;
			document.getElementById("date").value = formattedTimeDate;
			document.getElementById("timenow").value = formattedTimeTime;
			// Calcola il prossimo aggiornamento esatto tra 60 secondi
			const nextUpdate = 60000 - (now % 60000); // Calcola il tempo mancante
			setTimeout(updateTime, nextUpdate);
		}
		window.onload = updateTime; // Inizializza al caricamento della pagina



		//*****************************************************LOAD SESSION DATA*****************************************************
		function loadCurrentSession() {
		    const savedData = localStorage.getItem('currentSession');
		    if (savedData) {
		        const sessionData = JSON.parse(savedData);
		        document.getElementById('clock-in').value = sessionData.clockIn || '';
				document.getElementById('work-time').value = sessionData.workTime || '';
				document.getElementById('duratamin-pausa').value = sessionData.breakMinimum || '';
				document.getElementById('inizio-pausa').value = sessionData.breakStart || '';
				document.getElementById('fine-pausa').value = sessionData.breakEnd || '';
				document.getElementById('pausa-pranzo').checked = sessionData.breakDone || false;
		    }
		}
		document.addEventListener('DOMContentLoaded', loadCurrentSession);


		//*****************************************************STORE SESSION DATA*****************************************************
		// Salva in memoria i dati della sessione attuale
		function saveCurrentSession() {
		    const sessionData = {
		        clockIn: document.getElementById('clock-in').value,
		        workTime: document.getElementById('work-time').value,
		        breakMinimum: document.getElementById('duratamin-pausa').value,
		        breakStart: document.getElementById('inizio-pausa').value,
				breakEnd: document.getElementById('fine-pausa').value,
				breakDone: document.getElementById('pausa-pranzo').checked
		    };
		    localStorage.setItem('currentSession', JSON.stringify(sessionData));
		}
		// Ascolta i cambiamenti nei campi e aggiorna i dati
		document.querySelectorAll('input').forEach(input => {
		    input.addEventListener('input', saveCurrentSession);
		});



		// ********************************INCREMENT WORKTIME/CLOCKOUT WHEN TIMELEFT IS OVER *********************
		function updateWorkTime() {
		    // Prendere il valore di clock-in breakMin, breakStart, breakEnd, breakDone
		    var clockInInput = document.getElementById('clock-in').value;		
			var breakMinInput = document.getElementById('duratamin-pausa').value;
			var inizioPausaInput = document.getElementById('inizio-pausa').value;
			var finePausaInput = document.getElementById('fine-pausa').value;
			var breakDone = document.getElementById('pausa-pranzo').checked;
			
		    // Split dei valori temporali in (ore,) minuti, secondi
		    var clockInParts = clockInInput.split(":");
		    var breakMinParts = breakMinInput.split(":");
		    var inizioPausaParts = inizioPausaInput.split(":");
		    var finePausaParts = finePausaInput.split(":");
		
		    // Conversione dei valori temporali in secondi
		    var clockInSeconds = parseInt(clockInParts[0]) * 3600 + parseInt(clockInParts[1]) * 60 + (clockInParts[2] ? parseInt(clockInParts[2]) : 0);
		    var breakMinSeconds = parseInt(breakMinParts[0]) * 60 + (breakMinParts[1] ? parseInt(breakMinParts[1]) : 0);
		    var inizioPausaSeconds = parseInt(inizioPausaParts[0]) * 3600 + parseInt(inizioPausaParts[1]) * 60 + (inizioPausaParts[2] ? parseInt(inizioPausaParts[2]) : 0);
		    var finePausaSeconds = parseInt(finePausaParts[0]) * 3600 + parseInt(finePausaParts[1]) * 60 + (finePausaParts[2] ? parseInt(finePausaParts[2]) : 0);
		    

		    window.workTimeInterval = setInterval(() => {
		    	// Calcolo dell'ora attuale in secondi
		        var now = new Date();
		        var currentTimeSeconds = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();	
		        
		        if (!breakDone) {
		        	// Calcola la differenza in secondi tra l'ora attuale e clock-in
		        	var workTimeSeconds = currentTimeSeconds - clockInSeconds;
		        }
		        
		        if (breakDone) {
		        	// Calcola la differenza in secondi tra l'ora attuale e clock-in, sottraendo il tempo di pausa
		        	var breakDoneDuration = finePausaSeconds - inizioPausaSeconds;
		        	var workTimeSeconds = currentTimeSeconds - clockInSeconds - breakDoneDuration;
		        } 

		        // Converto workTimeSeconds in ore, minuti e secondi
		        var hours = Math.floor(workTimeSeconds / 3600);
		        var minutes = Math.floor((workTimeSeconds % 3600) / 60);
		        var seconds = workTimeSeconds % 60;
		        
		        // Formattiamo il tempo come HH:MM:SS
		        var formattedWorkTime = formatTimeWorkTime(hours) + ":" + formatTimeWorkTime(minutes) + ":" + formatTimeWorkTime(seconds);
		        
		        // Aggiorno il valore dell'input 'work-time'
		        var workTimeInput = document.getElementById('work-time');
		        workTimeInput.value = formattedWorkTime; // Aggiorniamo il valore dell'input
		    }, 1000);
		}
		
		function formatTimeWorkTime(time) {
		    return time < 10 ? "0" + time : time;
		}

		
		function updateClockOut() {
		    const clockOutElement = document.getElementById("clock-out");
		
		    if (!clockOutElement) return;
		
		    // Imposta un flag per dire ad aggiornaCountdown() di non sovrascrivere più clock-out
		    clockOutElement.dataset.manualUpdate = "true";
		
		    // Evita di avviare più intervalli
		    clearInterval(window.clockOutInterval);
		
		    window.clockOutInterval = setInterval(() => {
		        // Ottieni l'ora corrente
		        const now = new Date();
		
		        // Estrai ore, minuti e secondi
		        let hours = now.getHours();
		        let minutes = now.getMinutes();
		        let seconds = now.getSeconds();
		
		        // Crea la stringa di orario formattata
		        let currentTime = `<span id="editabletimehours" contenteditable="false">${String(hours).padStart(2, "0")}</span><span style="letter-spacing: 0px;">:</span><span id="editabletimeminutes" contenteditable="false">${String(minutes).padStart(2, "0")}</span><span style="letter-spacing: 0px;">:</span><span id="editabletimeseconds" contenteditable="false">${String(seconds).padStart(2, "0")}</span>`;
		
		        // Mostra l'ora corrente nell'elemento clock-out
		        clockOutElement.innerHTML = `<span style='font-size: 14.3px;'>CLOCK OUT</span> <br>${currentTime}`;
		    }, 1000);
		}


		//*****************************************************COUNTDOWN*****************************************************
		function aggiornaCountdown() {
			var clockin = document.getElementById('clock-in').value;		
			var clockinParts = clockin.split(":");
			var oreclockin = parseInt(clockinParts[0]);
			var minuticlockin = parseInt(clockinParts[1]);
			var secondiclockin = parseInt(clockinParts[2]);
			
			var workTimeInput = document.getElementById('work-time').value;	
			var workTimeParts = workTimeInput.split(":");
			var oreworktime = parseInt(workTimeParts[0]);
			var minutiworktime = parseInt(workTimeParts[1]);
			var secondiworktime = parseInt(workTimeParts[2]);
		
			var breakMinInput = document.getElementById('duratamin-pausa').value;
			var oradurataminpausa = breakMinInput.split(':');
			var oredurataminpausa = parseInt(oradurataminpausa[0]);
			var minutidurataminpausa = parseInt(oradurataminpausa[1]);
			
			var inizioPausa = document.getElementById('inizio-pausa').value;		
			var inizioPausaParts = inizioPausa.split(':');
			var oreinizioPausa = parseInt(inizioPausaParts[0]);
			var minutiinizioPausa = parseInt(inizioPausaParts[1]);
			var secondiinizioPausa = parseInt(inizioPausaParts[2]);
			
			var finePausa = document.getElementById('fine-pausa').value;		
			var finePausaParts = finePausa.split(':');
			var orefinePausa = parseInt(finePausaParts[0]);
			var minutifinePausa = parseInt(finePausaParts[1]);
			var secondifinePausa = parseInt(finePausaParts[2]);
		
			// Se WORK TIME è vuoto o manca una parte (ore, minuti o secondi), mostra --:--:-- e termina la funzione
			if (workTimeParts.length < 3 || workTimeParts.some(part => part === "")) {
				document.getElementById('clock-out').innerHTML = "<span style='font-size: 14.3px;'>CLOCK OUT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
				document.getElementById('countdown').innerHTML = "<span style='font-size: 14.3px; position: relative; left: -1.4px;'>TIME LEFT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
		
				return;
			}
		
			// Se BREAK MIN è vuoto, mostra --:--:-- e termina la funzione
			if (!breakMinInput || breakMinInput === "--:--") {
				document.getElementById('clock-out').innerHTML = "<span style='font-size: 14.3px;'>CLOCK OUT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
				document.getElementById('countdown').innerHTML = "<span style='font-size: 14.3px; position: relative; left: -1.4px;'>TIME LEFT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
		
				return;
			}
		
			// Se il valore di clock-in è stato rimosso o è incompleto (ore, minuti o secondi vuoti), mostra --:--:-- e termina la funzione
			if (clockinParts.length < 3 || clockinParts.some(part => part === "")) {
				document.getElementById('clock-out').innerHTML = "<span style='font-size: 14.3px;'>CLOCK OUT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
				document.getElementById('countdown').innerHTML = "<span style='font-size: 14.3px; position: relative; left: -1.4px;'>TIME LEFT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
		
				return;
			}
		
			// Verifica se il checkbox break done è attivato
			var breakDone = document.getElementById('pausa-pranzo').checked;
			if (breakDone) {
				// Se il valore di inizio pausa è stato rimosso o è incompleto (ore, minuti o secondi vuoti), mostra --:--:-- e termina la funzione
				if (inizioPausaParts.length < 3 || inizioPausaParts.some(part => part === "")) {
					document.getElementById('clock-out').innerHTML = "<span style='font-size: 14.3px;'>CLOCK OUT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
					document.getElementById('countdown').innerHTML = "<span style='font-size: 14.3px; position: relative; left: -1.4px;'>TIME LEFT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
		
					return;
				}
		
				// Se il valore di fine pausa è stato rimosso o è incompleto (ore, minuti o secondi vuoti), mostra --:--:-- e termina la funzione
				if (finePausaParts.length < 3 || finePausaParts.some(part => part === "")) {
					document.getElementById('clock-out').innerHTML = "<span style='font-size: 14.3px;'>CLOCK OUT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
					document.getElementById('countdown').innerHTML = "<span style='font-size: 14.3px; position: relative; left: -1.4px;'>TIME LEFT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
		
					return;
				}
		
				// Se BREAK END è anteriore a BREAK START, mostra --:--:-- e termina la funzione
				if (orefinePausa < oreinizioPausa ||
					(orefinePausa === oreinizioPausa && minutifinePausa < minutiinizioPausa) ||
					(orefinePausa === oreinizioPausa && minutifinePausa === minutiinizioPausa && secondifinePausa < secondiinizioPausa)) {
					document.getElementById('clock-out').innerHTML = "<span style='font-size: 14.3px;'>CLOCK OUT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
					document.getElementById('countdown').innerHTML = "<span style='font-size: 14.3px; position: relative; left: -1.4px;'>TIME LEFT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
		
					return;
				}
		
				// Se BREAK START è anteriore a CLOCK IN, mostra --:--:-- e termina la funzione
				if (oreinizioPausa < oreclockin ||
					(oreinizioPausa === oreclockin && minutiinizioPausa < minuticlockin) ||
					(oreinizioPausa === oreclockin && minutiinizioPausa === minuticlockin && secondiinizioPausa < secondiclockin)) {
					document.getElementById('clock-out').innerHTML = "<span style='font-size: 14.3px;'>CLOCK OUT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
					document.getElementById('countdown').innerHTML = "<span style='font-size: 14.3px; position: relative; left: -1.4px;'>TIME LEFT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
		
					return;
				}
			}
		
			// Aggiungi il tempo di work time all'ora di clock-in per calcolare l'ora di clock-out
			var oraUscita = new Date();
			oraUscita.setHours(oreclockin + oreworktime + oredurataminpausa);
			oraUscita.setMinutes(minuticlockin + minutiworktime + minutidurataminpausa);
			oraUscita.setSeconds(secondiclockin + secondiworktime);
		
			// Se la pausa pranzo è selezionata, aggiungi il tempo della pausa
			if (breakDone) {
				var duratapausa = new Date();
				duratapausa.setHours(orefinePausa - oreinizioPausa);
				duratapausa.setMinutes(minutifinePausa - minutiinizioPausa);
				duratapausa.setSeconds(secondifinePausa - secondiinizioPausa);
		
				// Aggiungi la durata della pausa all'ora di uscita
				oraUscita.setHours(oraUscita.getHours() + duratapausa.getHours() - oredurataminpausa);
				oraUscita.setMinutes(oraUscita.getMinutes() + duratapausa.getMinutes() - minutidurataminpausa);
				oraUscita.setSeconds(oraUscita.getSeconds() + duratapausa.getSeconds());
			}
		
			// Calcola il delta tra l'ora attuale e l'ora di uscita
			var oraAttuale = new Date().getTime(); // Ora attuale in millisecondi
			var delta = oraUscita.getTime() - oraAttuale; // Differenza tra ora di uscita e ora attuale
			if (delta <= 0) {
				// Se il countdown è finito
				var countdownElement = document.getElementById('countdown');
				countdownElement.innerHTML = "<span style='font-size: 14.3px; position: relative; left: -1.4px;'>TIME LEFT</span> <br>" + "00<span style='letter-spacing: 0px;'>:</span>00<span style='letter-spacing: 0px;'>:</span>00";
				countdownElement.classList.add('blink'); // Aggiungi la classe blink
		
				// Attiva tasto Clock Out
				document.getElementById('clockout-btn').addEventListener('click', function() {
					setTimeout(() => activateClockOut(), 460);
				});
				
				// Imposta allarme
				var alarmSound = document.getElementById('alarm-sound');
				if (alarmInterval === null) { // Evita di creare più intervalli sovrapposti
					alarmSound.play();
					alarmInterval = setInterval(function() {
						alarmSound.play();
					}, 2500);
				}
				
				updateWorkTime();
				updateClockOut();
				clearInterval(intervalId); // Ferma l'aggiornamento
				return;
			}
		
			// Calcola ore, minuti e secondi per il countdown
			var ore = Math.floor(delta / (1000 * 60 * 60));
			var minuti = Math.floor((delta % (1000 * 60 * 60)) / (1000 * 60));
			var secondi = Math.floor((delta % (1000 * 60)) / 1000);
		
			// Mostra il countdown nel formato HH:MM:SS
			document.getElementById('countdown').innerHTML = "<span style='font-size: 14.3px; position: relative; left: -1.4px;'>TIME LEFT</span> <br>" +
				String(ore).padStart(2, '0') + "<span style='letter-spacing: 0px;'>:</span>" +
				String(minuti).padStart(2, '0') + "<span style='letter-spacing: 0px;'>:</span>" +
				String(secondi).padStart(2, '0');
		
			// Mostra l'ora di uscita nel formato HH:MM:SS
			var oreUscita = String(oraUscita.getHours()).padStart(2, '0');
			var minutiUscita = String(oraUscita.getMinutes()).padStart(2, '0');
			var secondiUscita = String(oraUscita.getSeconds()).padStart(2, '0');
			const clockOutElement = document.getElementById('clock-out');
			if (!clockOutElement.dataset.manualUpdate) {
				clockOutElement.innerHTML = "<span style='font-size: 14.3px;'>CLOCK OUT</span> <br>" +
					oreUscita + "<span style='letter-spacing: 0px;'>:</span>" +
					minutiUscita + "<span style='letter-spacing: 0px;'>:</span>" +
					secondiUscita;
			}
		}
		
		// Avvia l'aggiornamento ogni secondo
		var intervalId = setInterval(aggiornaCountdown, 1000);



		//*****************************************************WORK TIME BUTTON*****************************************************
		// Imposta la durata di default "08:00:00" nel campo Work Time con ritardo
		const workTimeButton = document.getElementById('worktime-btn');
		workTimeButton.addEventListener('click', function() {
			const workTimeInputCurrent = document.getElementById('work-time');
			if (!workTimeInputCurrent) return;
		
			setTimeout(function() {
				const timeString = "08:00:00";
				workTimeInputCurrent.value = timeString;
				saveCurrentSession();
			}, 460);
		});
		
		
		
		//*****************************************************BREAK MIN BUTTON*****************************************************
		// Imposta la durata di default "00:30" nel campo Break Min con ritardo
		const breakMinButton = document.getElementById('breakmin-btn');
		breakMinButton.addEventListener('click', function() {
			const breakMinInputCurrent = document.getElementById('duratamin-pausa');
			if (!breakMinInputCurrent) return;
		
			setTimeout(function() {
				const timeString = "00:30";
				breakMinInputCurrent.value = timeString;
				saveCurrentSession();
			}, 460);
		});
		
		
		
		//*****************************************************FUNZIONE RESET*****************************************************
		function resetInputs() {
			// Resetta i valori degli input
			document.getElementById('work-time').value = '';
			document.getElementById('clock-in').value = '';
			document.getElementById('duratamin-pausa').value = '';
			document.getElementById('inizio-pausa').value = '';
			document.getElementById('fine-pausa').value = '';
			document.getElementById('pausa-pranzo').checked = false;
		
			// Resetta i valori degli input in caso che siano parzialmente riempiti
			const timeFields = ['work-time', 'clock-in', 'duratamin-pausa', 'inizio-pausa', 'fine-pausa'];
			timeFields.forEach(function(fieldId) {
				const field = document.getElementById(fieldId);
				if (field && field.type === 'time') {
					field.valueAsDate = null; // Resetta il campo time
				}
			});
		
			// Rimuovi la classe blink dal countdown e resetta il timer
			var countdownElement = document.getElementById('countdown');
			countdownElement.classList.remove('blink');
			countdownElement.innerHTML = "<span style='font-size: 14.3px; position: relative; left: -1.4px;'>TIME LEFT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
		
			var clockOutElement = document.getElementById('clock-out');
			clockOutElement.innerHTML = "<span style='font-size: 14.3px;'>CLOCK OUT</span> <br>--<span style='letter-spacing: 0px;'>:</span>--<span style='letter-spacing: 0px;'>:</span>--";
		
			// Assicurati che il bottone di salvataggio sia nascosto
			const saveBtn = document.getElementById('save-btn');
			const saveSpan = document.querySelector('.save-span');
			saveBtn.style.display = "none";
			saveSpan.style.display = "none";
		
			// Ferma l'allarme
			var alarmSound = document.getElementById('alarm-sound');
			alarmSound.pause();
			alarmSound.currentTime = 0; // Riporta l'audio all'inizio
			if (alarmInterval !== null) {
				clearInterval(alarmInterval);
				alarmInterval = null; // Reset della variabile
			}
		
			// Riavvia l'intervallo per calcolare il nuovo output e il nuovo time left
			location.reload();
			clearInterval(intervalId);
			intervalId = setInterval(aggiornaCountdown, 1000);
		}
		
		
		
		//*****************************************************CLR BUTTON*****************************************************
		document.getElementById('clr-btn').addEventListener('click', function() {
			setTimeout(() => {
				resetInputs();
				saveCurrentSession();
				// Ridimensiona la finestra
				const desiredWidth = 459;
				const desiredHeight = 354;
				let isChrome = /Chrome/.test(navigator.userAgent);
				if (isChrome) {
					desiredWidth -= 11;
					desiredHeight -= 40.5;
				}
				window.resizeTo(desiredWidth, desiredHeight);
			}, 460); 
			
			this.classList.add('active'); // Aggiungi la classe "active" per mostrare la X
			// Imposta un timeout per rimuovere la "X" con ritardo
			setTimeout(() => {
				this.classList.remove('active');
			}, 460);
		});
		
		// Attiva clr-btn premendo clr-btn-external (il tasto esterno)
		document.getElementById('clr-btn-external').addEventListener('click', function() {
			document.getElementById('clr-btn').click();
		});
		
		

		//*****************************************************TIME LEFT BUTTON*****************************************************		
		// Aggiungi evento al bottone Time Left
		document.getElementById('timeleft-btn').addEventListener('click', function() {
			setTimeout(() => {
				// Ferma l'allarme
				var alarmSound = document.getElementById('alarm-sound');
				alarmSound.pause();
				alarmSound.currentTime = 0; // Riporta l'audio all'inizio
				if (alarmInterval !== null) {
					clearInterval(alarmInterval);
					alarmInterval = null; // Reset della variabile
				}
				// Rimuovi lampeggio
				var countdownElement = document.getElementById('countdown');
				countdownElement.classList.remove('blink');
			}, 460); 
		});
		
		
		
		//*****************************************************CLOCK OUT BUTTON*****************************************************		
		// Aggiungi evento al bottone Time Left
		function activateClockOut() {
			// Ferma l'aggiornamento di Clock Out e Work Time
			clearInterval(window.clockOutInterval);
			clearInterval(window.workTimeInterval);
			
			// Rende editabile il campo Clock Out
			document.getElementById('editabletimehours').setAttribute('contenteditable', 'true');
			document.getElementById('editabletimeminutes').setAttribute('contenteditable', 'true');
			document.getElementById('editabletimeseconds').setAttribute('contenteditable', 'true');
			
			// Limita l'inserimento di caratteri nel campo delle ore a caratteri numerici, massimo 2, coppie da 00 a 23
			document.getElementById('editabletimehours').addEventListener('keypress', function(e) {
			    let currentText = this.innerText.replace(/[^0-9]/g, '');
			    
			    if (currentText.length >= 2) {		// Se ci sono già due caratteri, impedisci l'input
			        e.preventDefault();
			    }
			    
			    // Verifica che il numero inserito sia nel range da 00 a 23
			    let newText = currentText + e.key; // Aggiungi il tasto premuto al testo attuale
			    if (newText.length === 2) {
			        let num = parseInt(newText, 10); // Converte il testo in numero
			        if (num < 0 || num > 23) {
			            e.preventDefault(); // Impedisce l'inserimento se il numero non è valido
			        }
			    }
			});
			
			// Limita l'inserimento di caratteri nel campo dei minuti a caratteri numerici, massimo 2, coppie da 00 a 59
			document.getElementById('editabletimeminutes').addEventListener('keypress', function(e) {
			    let currentText = this.innerText.replace(/[^0-9]/g, '');

			    if (currentText.length >= 2) {
			        e.preventDefault();
			    }
			    
			    let newText = currentText + e.key;
			    if (newText.length === 2) {
			        let num = parseInt(newText, 10);
			        if (num < 0 || num > 59) {
			            e.preventDefault();
			        }
			    }
			});
			
			// Limita l'inserimento di caratteri nel campo dei minuti a caratteri numerici, massimo 2, coppie da 00 a 59
			document.getElementById('editabletimeseconds').addEventListener('keypress', function(e) {
			    let currentText = this.innerText.replace(/[^0-9]/g, '');
			    
			    if (currentText.length >= 2) {
			        e.preventDefault();
			    }
			    
			    let newText = currentText + e.key;
			    if (newText.length === 2) {
			        let num = parseInt(newText, 10);
			        if (num < 0 || num > 59) {
			            e.preventDefault();
			        }
			    }
			});
			
			// Inserisce uno 0 all'inizio nel campo ore se non sono stati inseriti esattamente due caratteri
			document.getElementById('editabletimehours').addEventListener('blur', function() {
			    let currentText = this.innerText.replace(/[^0-9]/g, '');
			    if (currentText.length === 1) {
			        this.innerText = '0' + currentText;
			    }
			});
			
			// Inserisce uno 0 all'inizio nel campo minuti se non sono stati inseriti esattamente due caratteri
			document.getElementById('editabletimeminutes').addEventListener('blur', function() {
			    let currentText = this.innerText.replace(/[^0-9]/g, '');
			    if (currentText.length === 1) {
			        this.innerText = '0' + currentText;
			    }
			});
			
			// Inserisce uno 0 all'inizio nel campo secondi se non sono stati inseriti esattamente due caratteri
			document.getElementById('editabletimeseconds').addEventListener('blur', function() {
			    let currentText = this.innerText.replace(/[^0-9]/g, '');
			    if (currentText.length === 1) {
			        this.innerText = '0' + currentText;
			    }
			});

			// Mostra bottone per il salvataggio dei dati sessione
			const saveBtn = document.getElementById('save-btn');
			const saveSpan = document.querySelector('.save-span');
			saveSpan.style.display = "block";
			saveBtn.style.display = "block";
			
			// Ferma l'allarme
			var alarmSound = document.getElementById('alarm-sound');
			alarmSound.pause();
			alarmSound.currentTime = 0; // Riporta l'audio all'inizio
			if (alarmInterval !== null) {
				clearInterval(alarmInterval);
				alarmInterval = null; // Reset della variabile
			// Rimuove lampeggio da Time Left
			var countdownElement = document.getElementById('countdown');
			countdownElement.classList.remove('blink');
			}
		}
		
		document.getElementById('clockout-btn').addEventListener('click', function() {
			return;
		});



		//*****************************************************SAVE BUTTON*****************************************************
		// Funzione per salvare i dati nel localStorage
		function saveData() {
			const confirmSave = confirm("Do you want to save the session data in the time log?");
			if (confirmSave) {
				newLogITEM(); // Aggiungi i dati della sessione appena finita al log nel LocalStorage
				alert("Time Log data has been saved!");
				resetInputs(); // Resetta i campi di input e il timer
				saveCurrentSession(); // Svuota i campi nella memoria della sessione attuale
    			document.getElementById('editabletimehours').setAttribute('contenteditable', 'false'); // Rende non editabile il campo
    			document.getElementById('editabletimeminutes').setAttribute('contenteditable', 'false');
    			document.getElementById('editabletimeseconds').setAttribute('contenteditable', 'false');
			} else {
				alert("Action cancelled. Data has not been saved.");
			}
			// Ridimensiona la finestra dopo l'avviso
			const desiredWidth = 459;
    		const desiredHeight = 354;
			let isChrome = /Chrome/.test(navigator.userAgent);
            if (isChrome) {
                desiredWidth -= 11;
                desiredHeight -= 40.5;
            }
    		window.resizeTo(desiredWidth, desiredHeight);
		}
		
		// Aggiungi evento al bottone "Save"
		document.getElementById('save-btn').addEventListener('click', function() {
			// Aggiungi la classe "active" per mostrare la X
			this.classList.add('active');
		
			// Imposta un timeout per rimuovere la "X"
			setTimeout(() => {
				this.classList.remove('active');
			}, 460);
			
			// Chiamata alla funzione save (con ritardo)
			setTimeout(() => saveData(), 480);
		});
		
		
		
		//*****************************************************STP BUTTON*****************************************************
		document.getElementById('stp-btn').addEventListener('click', function() {
			// Aggiungi la classe "active" per mostrare la X
			this.classList.add('active');
		
			// Imposta un timeout per rimuovere la "X"
			setTimeout(() => {
				this.classList.remove('active');
			}, 460);
		
			// Usa setTimeout per ritardare l'esecuzione dei calcoli
			setTimeout(function() {
				// Ottieni gli input necessari
				var clockinInput = document.getElementById('clock-in').value;
				var workTimeInput = document.getElementById('work-time').value;
				var pausaInput = document.getElementById('duratamin-pausa').value;
		
				// Se i valori sono incompleti, esci dalla funzione
				if (!clockinInput || !workTimeInput || !pausaInput) return;
		
				// Converte gli orari clock-in e work-time in secondi
				var clockinParts = clockinInput.split(":");
				var clockinInSeconds = parseInt(clockinParts[0]) * 3600 + parseInt(clockinParts[1]) * 60 + parseInt(clockinParts[2]);
		
				var workTimeParts = workTimeInput.split(":");
				var workTimeInSeconds = parseInt(workTimeParts[0]) * 3600 + parseInt(workTimeParts[1]) * 60 + parseInt(workTimeParts[2]);
		
				// Ottiene l'ora attuale in secondi dalla mezzanotte di oggi
				var now = new Date();
				var midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate()); // mezzanotte di oggi
				var currentTimeInSeconds = Math.floor((now - midnight) / 1000); // differenza in secondi
		
				// Ottieni il delta tra ora attuale e clock in, più 5 secondi
				var deltaClockInActualTime = (currentTimeInSeconds + 5) - clockinInSeconds;
		
				// Se il checkbox breakDone è selezionato, utilizza il delta tra inizio-pausa e fine-pausa
				var breakDone = document.getElementById('pausa-pranzo').checked;
		
				if (breakDone) {
					// Calcola il delta della pausa
					var inizioPausa = document.getElementById('inizio-pausa').value;
					var finePausa = document.getElementById('fine-pausa').value;
		
					// Se BREAK START o BREAK END sono vuoti, esci dalla funzione
					if (!inizioPausa || !finePausa) return;
		
					var inizioPausaSplit = inizioPausa.split(':');
					var finePausaSplit = finePausa.split(':');
		
					var oreInizioPausa = parseInt(inizioPausaSplit[0]);
					var minutiInizioPausa = parseInt(inizioPausaSplit[1]);
					var secondiInizioPausa = parseInt(inizioPausaSplit[2]);
		
					var oreFinePausa = parseInt(finePausaSplit[0]);
					var minutiFinePausa = parseInt(finePausaSplit[1]);
					var secondiFinePausa = parseInt(finePausaSplit[2]);
		
					// Calcola la durata della pausa effettiva in secondi
					var durataPausaInSecondi = ((oreFinePausa - oreInizioPausa) * 3600) +
						((minutiFinePausa - minutiInizioPausa) * 60) +
						(secondiFinePausa - secondiInizioPausa);
		
					// Usa la durata effettiva della pausa invece di quella preimpostata
					pausaInSeconds = durataPausaInSecondi;
		
					// Calcola il nuovo valore di work-time in secondi quando la pausa è stata fatta
					var newWorkTimeInSeconds = deltaClockInActualTime - durataPausaInSecondi;
				} else {
					// Reimposta la pausa minima come 00:00
					var newPausaInput = `${String(0).padStart(2, '0')}:${String(0).padStart(2, '0')}`;
					document.getElementById('duratamin-pausa').value = newPausaInput;
		
					// Converte la durata pausa in secondi (pausa in minuti)
					var pausaParts = pausaInput.split(":"); // separa le ore e i minuti
					var pausaInMinutes = parseInt(pausaParts[0]) * 60 + parseInt(pausaParts[1]); // converte in minuti
					var pausaInSeconds = pausaInMinutes * 60; // converte i minuti in secondi
					// Calcola il nuovo valore di work-time in secondi quando la pausa non è stata fatta
					var newWorkTimeInSeconds = deltaClockInActualTime;
				}
		
				// Converte il nuovo valore di work-time in ore, minuti, secondi
				var hoursRemaining = Math.floor(newWorkTimeInSeconds / 3600);
				var minutesRemaining = Math.floor((newWorkTimeInSeconds % 3600) / 60);
				var secondsRemaining = Math.floor(newWorkTimeInSeconds % 60);
		
				// Imposta il nuovo valore di work-time
				var newWorkTime = `${String(hoursRemaining).padStart(2, '0')}:${String(minutesRemaining).padStart(2, '0')}:${String(secondsRemaining).padStart(2, '0')}`;
				document.getElementById('work-time').value = newWorkTime;
			}, 460);
			setTimeout(() => {	// Aggiorna i dati nello store della sessione attuale
				saveCurrentSession();
			}, 1500); 
		});
		
		// Attiva stp-btn premendo stp-btn-external (il tasto sull'fmc)
		document.getElementById('stp-btn-external').addEventListener('click', function() {
			document.getElementById('stp-btn').click();
		});



		//*****************************************************BREAK DONE BUTTON*****************************************************
		function toggleCheckbox() {
			var checkbox = document.getElementById("pausa-pranzo");
			checkbox.checked = !checkbox.checked; // Cambia lo stato del checkbox (attivato/disattivato)
		}
		
		// Attiva pausa-pranzo premendo breakdone-btn (il tasto esterno)
		document.addEventListener('DOMContentLoaded', function() {
			var button = document.getElementById('breakdone-btn');
		
			// Aggiunge un ritardo prima di eseguire la funzione toggleCheckbox
			button.addEventListener('click', function() {
				setTimeout(function() {
					toggleCheckbox();
					saveCurrentSession();
				}, 460);
			});
		});



		//*****************************************************CLOCK IN BUTTON*****************************************************
		// Imposta l'ora attuale nel campo Clock In con ritardo
		const clockInButton = document.getElementById('enterclockin-btn');
		clockInButton.addEventListener('click', function() {
			const clockInInputCurrent = document.getElementById('clock-in');
			if (!clockInInputCurrent) return;
		
			setTimeout(function() {
				const currentTime = new Date();
		
				const hours = String(currentTime.getHours()).padStart(2, '0');
				const minutes = String(currentTime.getMinutes()).padStart(2, '0');
				const seconds = String(currentTime.getSeconds()).padStart(2, '0');
		
				const timeString = `${hours}:${minutes}:${seconds}`;
				clockInInputCurrent.value = timeString;
				
				saveCurrentSession();
			}, 460);
		});



		//*****************************************************BREAK START BUTTON*****************************************************
		// Imposta l'ora attuale nel campo Break Start con ritardo
		const breakStartButton = document.getElementById('breakstart-btn');
		breakStartButton.addEventListener('click', function() {
			const breakStartInput = document.getElementById('inizio-pausa');
			if (!breakStartInput) return;
		
			setTimeout(function() {
				const currentTime = new Date();
		
				const hours = String(currentTime.getHours()).padStart(2, '0');
				const minutes = String(currentTime.getMinutes()).padStart(2, '0');
				const seconds = String(currentTime.getSeconds()).padStart(2, '0');
		
				const timeString = `${hours}:${minutes}:${seconds}`;
				breakStartInput.value = timeString;
				
				saveCurrentSession();
			}, 460);
		});



		//*****************************************************BREAK END BUTTON*****************************************************
		// Imposta l'ora attuale nel campo Break End
		const breakEndButton = document.getElementById('breakend-btn');
		breakEndButton.addEventListener('click', function() {
			const breakEndButton = document.getElementById('fine-pausa');
			if (!breakEndButton) return;
		
			setTimeout(function() {
				const currentTime = new Date();
		
				const hours = String(currentTime.getHours()).padStart(2, '0');
				const minutes = String(currentTime.getMinutes()).padStart(2, '0');
				const seconds = String(currentTime.getSeconds()).padStart(2, '0');
		
				const timeString = `${hours}:${minutes}:${seconds}`;
				breakEndButton.value = timeString;
				
				// Se breakDone non è attivo, attivalo automaticamente se inserisci un valore in breakEnd e breakStart ha già un valore.
				const breakStartInput = document.getElementById('inizio-pausa');
				if (breakStartInput && breakStartInput.value !== "") {
				    const breakDone = document.getElementById('pausa-pranzo').checked;
				    if (!breakDone) {
				        toggleCheckbox();
				    }
				}
				
				saveCurrentSession();
			}, 460);
		});
		
		
		
		//************************************************LOG DATE/TIME FORMAT******************************************
		// Funzione per ottenere la data in formato DD-MM-YYYY
		function getFormattedDate() {
			const today = new Date();
			const day = today.getDate().toString().padStart(2, '0'); // Aggiunge uno zero se il giorno è un singolo numero
			const month = (today.getMonth() + 1).toString().padStart(2, '0'); // Aggiunge uno zero se il mese è un singolo numero
			const year = today.getFullYear();
		
			return `${day}-${month}-${year}`; // Restituisce la data nel formato DD-MM-YYYY
		}
		
		// Funzione per formattare i secondi in formato HH:MM:SS
		function formatTime(seconds) {
			const hours = Math.floor(seconds / 3600);
			const minutes = Math.floor((seconds % 3600) / 60);
			const remainingSeconds = seconds % 60;
		
			return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
		}
		
		// Funzione per convertire l'orario in secondi
		function timeToSeconds(time) {
			const [hours, minutes, seconds] = time.split(':').map(Number);
		
			return hours * 3600 + minutes * 60 + seconds;
		}
		
		
		
		//**********************************************LOG WORK/BREAK TIME IN SECONDS****************************************
		function calculateDurations(clockIn, breakStart, breakEnd, clockOut) {
			var breakDone = document.getElementById('pausa-pranzo').checked;
			const clockInSeconds = timeToSeconds(clockIn);
			const breakStartSeconds = timeToSeconds(breakStart);
			const breakEndSeconds = timeToSeconds(breakEnd);
			const clockOutSeconds = timeToSeconds(clockOut);
		
			let breakDuration;
			let totalWorkTime;
		
			if (breakDone) {
				breakDuration = breakEndSeconds - breakStartSeconds;
				totalWorkTime = clockOutSeconds - clockInSeconds - breakDuration;
			} else {
				totalWorkTime = clockOutSeconds - clockInSeconds;
				breakDuration = 0;
			}
		
			// Controllo se totalWorkTime è negativo
			if (totalWorkTime < 0) {
			    totalWorkTime = "Invalid";
			}
			
			return {
				workTime: totalWorkTime, // In secondi
				breakDurationInSeconds: breakDuration // Restituisce sempre breakDuration in secondi
			};
		}
		
		
		
		//************************************************ADD DATA TO LOG IN THE LOCAL STORAGE******************************************
		// Funzione per caricare il log dal Local Storage (se presente)
		function loadExistingLOG() {
			const existingData = localStorage.getItem('timeLog');
		
			return existingData ? JSON.parse(existingData) : {}; // Se non c'è, restituisce un oggetto vuoto
		}
		
		// Funzione per aggiungere nuovi dati (ottenuti da newLogITEM()) al log esistente
		function appendToLOG(newData) {
			const currentDate = getFormattedDate(); // Ottiene la data formattata in DD-MM-YYYY
			const existingData = loadExistingLOG();
		
			// Aggiungi i nuovi dati alla data odierna
			if (!existingData[currentDate]) {
				existingData[currentDate] = [];
			}
			existingData[currentDate].push(newData);
		
			// Salva di nuovo nel localStorage
			localStorage.setItem('timeLog', JSON.stringify(existingData));
		}
		
		// Funzione per generare un nuovo oggetto con i dati della sessione appena finita e aggiungerlo al log nel Local Storage tramite appendToLOG()
		function newLogITEM() {
		    var breakDone = document.getElementById('pausa-pranzo').checked;
		    const clockIn = document.getElementById('clock-in').value;
		    const clockOutRaw = document.getElementById('clock-out').value;
		    const clockOut = clockOutRaw.split(' ')[2];
		
		    let breakStart = '';
		    let breakEnd = '';
		    let breakDuration;
		
		    if (breakDone) {
		        breakStart = document.getElementById('inizio-pausa').value;
		        breakEnd = document.getElementById('fine-pausa').value;
		
		        // Calcola i dati da `calculateDurations()`
		        const {
		            workTime,
		            breakDurationInSeconds
		        } = calculateDurations(clockIn, breakStart, breakEnd, clockOut);
		
		        // Se workTime è "None", non formattiamo il tempo
		        const workTimeFormatted = (workTime === "Invalid") ? "Invalid" : formatTime(workTime);
		
		        // Formatta `breakDurationInSeconds` usando `formatTime`
		        breakDuration = formatTime(breakDurationInSeconds);
		
		        const timeData = {
		            clockIn: clockIn,
		            clockOut: clockOut,
		            workTime: workTimeFormatted,
		            breakStart: breakStart,
		            breakEnd: breakEnd,
		            breakTime: breakDuration,
		        };
		        appendToLOG(timeData);
		    } else {
		        const {
		            workTime,
		            breakDurationInSeconds
		        } = calculateDurations(clockIn, breakStart, breakEnd, clockOut);
		
		        // Se workTime è "None", non formattiamo il tempo
		        const workTimeFormatted = (workTime === "Invalid") ? "Invalid" : formatTime(workTime);
		
		        const timeData = {
		            clockIn: clockIn,
		            clockOut: clockOut,
		            workTime: workTimeFormatted,
		            breakStart: "None",
		            breakEnd: "None",
		            breakTime: "00:00:00", // Per il caso senza pausa
		        };
		        appendToLOG(timeData);
		    }
		}

		
		// Funzione per generare e scaricare un file JSON con i dati presenti nel Local Storage
		function generateJSON() {
			// Carica il JSON esistente
			const allData = loadExistingLOG();
		
			// Converte i dati in una stringa JSON
			const jsonData = JSON.stringify(allData, null, 2);
		
			// Crea un Blob con i dati JSON
			const blob = new Blob([jsonData], {
				type: 'application/json'
			});
		
			// Crea un link per scaricare il file JSON
			const link = document.createElement('a');
			link.href = URL.createObjectURL(blob);
			link.download = 'timeLog.json'; // Nome del file JSON
			// Ritarda l'esecuzione del download
			setTimeout(() => {
				link.click();
			}, 480);
		}
		
		// Aggiunge evento al bottone "getlogs-btn"
		document.getElementById('getlogs-btn').addEventListener('click', function() {
			generateJSON(); // Chiamata alla funzione generateJSON
		
			this.classList.add('active'); // Aggiunge la classe "active" per mostrare la X
		
			// Imposta un timeout per rimuovere la "X"
			setTimeout(() => {
				this.classList.remove('active');
			}, 460);
		});
		
		// Attiva getlogs-btn premendo getlogs-btn-external (il tasto esterno)
		document.getElementById('getlogs-btn-external').addEventListener('click', function() {
			document.getElementById('getlogs-btn').click();
		});
		
		
		
		//************************************************EMPTY LOG IN LOCAL STORAGE******************************************
		// Funzione per rimuovere i dati dal localStorage (con ritardo)
		function clearData() {
			setTimeout(() => {
				const confirmClear = confirm("Are you sure you want to clear all time log data?");
				if (confirmClear) {
					localStorage.removeItem('timeLog'); // Rimuove il dato 'timeLog' dal localStorage
					alert("Time Log data has been cleared!");
				} else {
					alert("Action cancelled. Data has not been cleared.");
				}
				// Ridimensiona la finestra dopo l'avviso
				const desiredWidth = 459;
				const desiredHeight = 354;
				let isChrome = /Chrome/.test(navigator.userAgent);
				if (isChrome) {
					desiredWidth -= 11;
					desiredHeight -= 40.5;
				}
				window.resizeTo(desiredWidth, desiredHeight);
			}, 480);
		}
		
		// Aggiunge evento al bottone "Clear Time Log"
		document.getElementById('clearlogs-btn').addEventListener('click', function() {
			this.classList.add('active'); // Aggiunge la classe "active" per mostrare la X immediatamente
			clearData(); // Chiama la funzione clearData subito dopo l'aggiunta della classe "active"
		
			// Imposta un timeout per rimuovere la "X"
			setTimeout(() => {
				this.classList.remove('active');
			}, 460);
		});
	</script>

</body>
</html>
